{% extends "base.html" %}
{% set title = "Agent Configuration" %}
{% set active_page = "agents" %}
{% block content %}

  {% include 'admin/_header.html' %}

  <!-- Agent Configuration Form -->
  <form action="{{ url_for('admin.agent_config') }}" method="post" class="mb-8">
    <div class="flex flex-wrap -mx-2">

      <!-- Nmap Config Column -->
      <div class="w-full md:w-1/3 px-2 mb-6">
        <h3 class="text-xl font-bold mb-4">Nmap Config</h3>
        {{ agentForm.hidden_tag() }}

        <!-- Version Detection -->
        <div class="flex items-center mb-3">
          {{ agentForm.versionDetection(class="form-checkbox h-4 w-4 text-blue-600") }}
          {{ agentForm.versionDetection.label(class="ml-2 text-gray-700") }}
        </div>

        <!-- OS Detection -->
        <div class="flex items-center mb-3">
          {{ agentForm.osDetection(class="form-checkbox h-4 w-4 text-blue-600") }}
          {{ agentForm.osDetection.label(class="ml-2 text-gray-700") }}
        </div>

        <!-- Enable Scripts -->
        <div class="flex items-center mb-3">
          {{ agentForm.enableScripts(class="form-checkbox h-4 w-4 text-blue-600") }}
          {{ agentForm.enableScripts.label(class="ml-2 text-gray-700") }}
        </div>

        <!-- Only Opens -->
        <div class="flex items-center mb-3">
          {{ agentForm.onlyOpens(class="form-checkbox h-4 w-4 text-blue-600") }}
          {{ agentForm.onlyOpens.label(class="ml-2 text-gray-700") }}
        </div>

        <!-- OS Scan Limit -->
        <div class="flex items-center mb-3">
          {{ agentForm.osScanLimit(class="form-checkbox h-4 w-4 text-blue-600") }}
          {{ agentForm.osScanLimit.label(class="ml-2 text-gray-700") }}
        </div>

        <!-- No Ping -->
        <div class="flex items-center mb-3">
          {{ agentForm.noPing(class="form-checkbox h-4 w-4 text-blue-600") }}
          {{ agentForm.noPing.label(class="ml-2 text-gray-700") }}
        </div>

        <!-- UDP Scan -->
        <div class="flex items-center mb-4">
          {{ agentForm.udpScan(class="form-checkbox h-4 w-4 text-blue-600") }}
          {{ agentForm.udpScan.label(class="ml-2 text-gray-700") }}
        </div>

        <!-- Scan Timeout -->
        <div class="mb-4">
          <label class="block text-sm font-medium text-gray-700">
            {{ agentForm.scanTimeout.label.text }}
          </label>
          <div class="mt-1 flex rounded-md shadow-sm">
            {{ agentForm.scanTimeout(class="block w-full rounded-l-md border border-gray-300 px-3 py-2 focus:outline-none focus:ring focus:border-blue-300", placeholder="660") }}
            <span class="inline-flex items-center px-3 rounded-r-md border border-l-0 border-gray-300 bg-gray-50 text-gray-500 text-sm">s</span>
          </div>
        </div>

        <!-- Script Timeout -->
        <div class="mb-4">
          <label class="sr-only">
            {{ agentForm.scriptTimeout.label.text }}
          </label>
          <div class="mt-1 flex rounded-md shadow-sm">
            <span class="inline-flex items-center px-3 rounded-l-md border border-gray-300 bg-gray-50 text-gray-500 text-sm">--script-timeout</span>
            {{ agentForm.scriptTimeout(class="block w-full border border-gray-300 px-3 py-2 focus:outline-none focus:ring focus:border-blue-300", placeholder="60") }}
            <span class="inline-flex items-center px-3 rounded-r-md border border-l-0 border-gray-300 bg-gray-50 text-gray-500 text-sm">s</span>
          </div>
        </div>

        <!-- Host Timeout -->
        <div class="mb-4">
          <label class="sr-only">
            {{ agentForm.hostTimeout.label.text }}
          </label>
          <div class="mt-1 flex rounded-md shadow-sm">
            <span class="inline-flex items-center px-3 rounded-l-md border border-gray-300 bg-gray-50 text-gray-500 text-sm">--host-timeout</span>
            {{ agentForm.hostTimeout(class="block w-full border border-gray-300 px-3 py-2 focus:outline-none focus:ring focus:border-blue-300", placeholder="600") }}
            <span class="inline-flex items-center px-3 rounded-r-md border border-l-0 border-gray-300 bg-gray-50 text-gray-500 text-sm">s</span>
          </div>
        </div>

        <!-- Update Agents Button -->
        <div class="text-center">
          {{ agentForm.updateAgents(class="mt-4 bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded") }}
        </div>
      </div>

      <!-- Screenshot Settings Column -->
      <div class="w-full md:w-1/3 px-2 mb-6">
        <h3 class="text-xl font-bold mb-4">Screenshot Settings</h3>

        <!-- Web Screenshots -->
        <div class="flex items-center mb-4">
          {{ agentForm.webScreenshots(class="form-checkbox h-4 w-4 text-blue-600") }}
          {{ agentForm.webScreenshots.label(class="ml-2 text-gray-700") }}
        </div>

        <!-- Web Screenshot Timeout -->
        <div class="mb-4">
          <label class="block text-sm font-medium text-gray-700">
            {{ agentForm.webScreenshotTimeout.label.text }}
          </label>
          <div class="mt-1 flex rounded-md shadow-sm">
            {{ agentForm.webScreenshotTimeout(class="block w-full rounded-l-md border border-gray-300 px-3 py-2 focus:outline-none focus:ring focus:border-blue-300", placeholder="60") }}
            <span class="inline-flex items-center px-3 rounded-r-md border border-l-0 border-gray-300 bg-gray-50 text-gray-500 text-sm">s</span>
          </div>
        </div>

        <!-- VNC Screenshots -->
        <div class="flex items-center mb-4">
          {{ agentForm.vncScreenshots(class="form-checkbox h-4 w-4 text-blue-600") }}
          {{ agentForm.vncScreenshots.label(class="ml-2 text-gray-700") }}
        </div>

        <!-- VNC Screenshot Timeout -->
        <div class="mb-4">
          <label class="block text-sm font-medium text-gray-700">
            {{ agentForm.vncScreenshotTimeout.label.text }}
          </label>
          <div class="mt-1 flex rounded-md shadow-sm">
            {{ agentForm.vncScreenshotTimeout(class="block w-full rounded-l-md border border-gray-300 px-3 py-2 focus:outline-none focus:ring focus:border-blue-300", placeholder="60") }}
            <span class="inline-flex items-center px-3 rounded-r-md border border-l-0 border-gray-300 bg-gray-50 text-gray-500 text-sm">s</span>
          </div>
        </div>
      </div>
    </div>
  </form>

  <!-- Scripts Column -->
  <div class="flex flex-wrap -mx-2">
    <div class="w-full md:w-1/3 px-2">
      <h3 class="text-xl font-bold mb-4">Scripts</h3>

      {% if scripts %}
        <ul class="list-disc pl-5 mb-4">
          {% for script in scripts %}
            <li class="mb-2 flex items-center justify-between">
              <span>{{ script.name }}</span>
              <form method="POST" action="{{ url_for('admin.delete_script', name=script.name) }}" class="inline-block">
                {{ delScriptForm.hidden_tag() }}
                <button id="deleteScript-{{ loop.index }}" name="deleteScript" title='Delete Script "{{ script.name }}"'
                  onclick="return confirm('Are you sure you want to stop running {{ script.name }}?')"
                  type="submit"
                  class="text-red-500 hover:text-red-600 inline-flex items-center"
                >
                  <i class="fas fa-times mx-2 my-1"></i>
                </button>
              </form>
            </li>
          {% endfor %}
        </ul>
      {% endif %}

      <!-- Add Script Form -->
      <form method="post" action="{{ url_for('admin.add_script') }}" name="addScriptForm" id="addScriptForm" class="flex items-center">
        {{ addScriptForm.hidden_tag() }}
        {{ addScriptForm.scriptName(class="border border-gray-300 rounded-md px-3 py-2 w-full", placeholder="default") }}
        <button id="addScript" name="addScript" title="Add Script" type="submit" class="ml-2 text-green-500 hover:text-green-600 inline-flex items-center">
          <i class="fas fa-plus-circle"></i>
        </button>
      </form>
    </div>
  </div>

{% endblock %}
